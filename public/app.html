<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bengkel Pro - Profesional & Terpercaya</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Open+Sans&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <style>
        body { font-family: 'Open Sans', sans-serif; overflow-x: hidden; }
        h1, h2, h3, h4, h5 { font-family: 'Montserrat', sans-serif; font-weight: 700; }
        
        /* Navbar Transparan jadi Solid */
        .navbar { transition: 0.3s; backdrop-filter: blur(10px); background: rgba(0,0,0,0.8); }
        .nav-link { font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }

        /* Hero Carousel (Slider Gambar Besar) */
        .carousel-item { height: 80vh; min-height: 400px; background: no-repeat center center scroll; background-size: cover; }
        .carousel-caption { bottom: 20%; z-index: 2; text-shadow: 2px 2px 10px rgba(0,0,0,0.7); }
        .overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.4); }

        /* Service Cards */
        .service-box { transition: 0.3s; border: 1px solid #eee; border-radius: 10px; overflow: hidden; }
        .service-box:hover { transform: translateY(-10px); box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-color: #ff5e00; }
        .icon-circle { width: 70px; height: 70px; background: #ff5e00; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; margin: 0 auto 20px; }

        /* Form Section */
        .booking-section { background-color: #f8f9fa; padding: 60px 0; }
        .main-card { border: none; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .btn-orange { background-color: #ff5e00; color: white; border: none; padding: 12px 30px; border-radius: 50px; font-weight: bold; transition: 0.3s; }
        .btn-orange:hover { background-color: #e04e00; color: white; transform: scale(1.05); }

        /* Utilities */
        .text-orange { color: #ff5e00; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand fw-bold fs-3" href="#">üõ†Ô∏è BENGKEL<span class="text-orange">PRO</span></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav align-items-center">
                    <li class="nav-item"><a class="nav-link text-white" href="#home">Home</a></li>
                    <li class="nav-item"><a class="nav-link text-white" href="#services">Layanan</a></li>
                    <li class="nav-item"><a class="nav-link text-white" href="#booking">Booking</a></li>
                    <li class="nav-item ms-3">
                        <button id="btn-login-nav" onclick="showLoginModal()" class="btn btn-outline-light btn-sm rounded-pill px-4">Login Admin</button>
                        <button id="btn-logout-nav" onclick="logout()" class="btn btn-danger btn-sm rounded-pill px-4 hidden">Logout</button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <section id="home">
        <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active"></button>
                <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1"></button>
                <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2"></button>
            </div>
            <div class="carousel-inner">
                <div class="carousel-item active" style="background-image: url('https://images.unsplash.com/photo-1530046339160-711533799e87?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80')">
                    <div class="overlay"></div>
                    <div class="carousel-caption d-none d-md-block" data-aos="fade-up">
                        <h1 class="display-3 fw-bold">Solusi Perawatan Mobil</h1>
                        <p class="lead">Teknisi profesional siap menangani kendaraan Anda dengan peralatan modern.</p>
                        <a href="#booking" class="btn btn-orange mt-3">Booking Sekarang</a>
                    </div>
                </div>
                <div class="carousel-item" style="background-image: url('https://images.unsplash.com/photo-1487754180451-c456f719a1fc?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80')">
                    <div class="overlay"></div>
                    <div class="carousel-caption d-none d-md-block">
                        <h1 class="display-3 fw-bold">Ganti Oli Kilat</h1>
                        <p class="lead">Hanya 30 menit, mobil Anda siap melaju kencang kembali.</p>
                        <a href="#services" class="btn btn-outline-light rounded-pill px-4 mt-3">Lihat Layanan</a>
                    </div>
                </div>
                <div class="carousel-item" style="background-image: url('https://images.unsplash.com/photo-1486262715619-67b85e0b08d3?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80')">
                    <div class="overlay"></div>
                    <div class="carousel-caption d-none d-md-block">
                        <h1 class="display-3 fw-bold">Admin Dashboard</h1>
                        <p class="lead">Pantau antrian dan manajemen bengkel secara real-time.</p>
                    </div>
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon"></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon"></span>
            </button>
        </div>
    </section>

    <div id="admin-panel" class="container mt-5 hidden" data-aos="fade-in">
        <div class="card bg-dark text-white p-4 rounded-4 shadow">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <h4 class="text-orange mb-0">üî• ADMIN AREA</h4>
                    <small>Selamat bekerja, Bos!</small>
                </div>
                <div class="col-md-3 text-center border-start border-secondary">
                    <h2>üìÖ <span id="stat-total">0</span></h2>
                    <small>Total Antrian</small>
                </div>
                <div class="col-md-3 text-center border-start border-secondary">
                    <h2 class="text-success">üõ¢Ô∏è <span id="stat-oli">0</span></h2>
                    <small>Ganti Oli</small>
                </div>
                <div class="col-md-3 text-center border-start border-secondary">
                    <h2 class="text-warning">‚öôÔ∏è <span id="stat-lain">0</span></h2>
                    <small>Service Lain</small>
                </div>
            </div>
        </div>
    </div>

    <section id="services" class="py-5">
        <div class="container">
            <div class="text-center mb-5" data-aos="fade-up">
                <h6 class="text-orange fw-bold">LAYANAN KAMI</h6>
                <h2>Apa yang Kami Kerjakan?</h2>
                <div class="mx-auto bg-orange" style="width: 60px; height: 3px; background: #ff5e00;"></div>
            </div>

            <div class="row">
                <div class="col-md-4 mb-4" data-aos="fade-up" data-aos-delay="100">
                    <div class="service-box p-4 text-center">
                        <div class="icon-circle">üõ¢Ô∏è</div>
                        <h4>Ganti Oli</h4>
                        <p class="text-muted">Pelumas terbaik untuk mesin kendaraan Anda agar tetap awet.</p>
                    </div>
                </div>
                <div class="col-md-4 mb-4" data-aos="fade-up" data-aos-delay="200">
                    <div class="service-box p-4 text-center">
                        <div class="icon-circle">üîß</div>
                        <h4>Tune Up</h4>
                        <p class="text-muted">Pengecekan menyeluruh performa mesin dan sistem kelistrikan.</p>
                    </div>
                </div>
                <div class="col-md-4 mb-4" data-aos="fade-up" data-aos-delay="300">
                    <div class="service-box p-4 text-center">
                        <div class="icon-circle">‚öôÔ∏è</div>
                        <h4>Turun Mesin</h4>
                        <p class="text-muted">Perbaikan berat ditangani oleh teknisi bersertifikat.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="booking" class="booking-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-4" data-aos="fade-right">
                    <div class="card main-card p-4 bg-white">
                        <h4 class="fw-bold mb-4">üìù Form Booking</h4>
                        <div class="mb-3">
                            <label class="fw-bold small">NAMA PELANGGAN</label>
                            <input type="text" id="name" class="form-control" placeholder="Masukkan nama...">
                        </div>
                        <div class="mb-3">
                            <label class="fw-bold small">JADWAL</label>
                            <input type="datetime-local" id="booking_time" class="form-control">
                        </div>
                        <div class="mb-4">
                            <label class="fw-bold small">LAYANAN</label>
                            <select id="service" class="form-select">
                                <option value="Ganti Oli">Ganti Oli</option>
                                <option value="Service Ringan">Service Ringan</option>
                                <option value="Turun Mesin">Turun Mesin</option>
                                <option value="Konsultasi">Konsultasi</option>
                            </select>
                        </div>
                        <div class="d-grid gap-2">
                            <button onclick="kirimData()" id="btn-submit" class="btn btn-orange shadow">BOOKING SEKARANG</button>
                            <button onclick="resetForm()" id="btn-cancel" class="btn btn-secondary hidden">BATAL</button>
                        </div>
                    </div>
                </div>

                <div class="col-lg-8" data-aos="fade-left">
                    <div class="card main-card p-4 bg-white h-100">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h4 class="fw-bold mb-0">üìã Antrian Saat Ini</h4>
                            <input type="text" id="search" onkeyup="cariData()" class="form-control w-50" placeholder="üîç Cari nama pelanggan...">
                        </div>
                        <div class="table-responsive">
                            <table class="table align-middle">
                                <thead class="table-light">
                                    <tr>
                                        <th>Nama</th>
                                        <th>Service</th>
                                        <th>Jadwal</th>
                                        <th class="text-end admin-only hidden">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="daftar-booking"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-dark text-white py-4 text-center">
        <div class="container">
            <p class="mb-0">¬© 2026 Bengkel Abang Atuy.</p>
        </div>
    </footer>

    <div class="modal fade" id="loginModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title">üîí Login Admin</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <input type="email" id="email-login" class="form-control mb-3" value="admin@bengkel.com" placeholder="Email">
                    <input type="password" id="pass-login" class="form-control mb-3" value="password123" placeholder="Password">
                    <button onclick="prosesLogin()" class="btn btn-orange w-100 fw-bold">MASUK</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <script>
        // INISIALISASI ANIMASI SCROLL (AOS)
        AOS.init({ duration: 1000, once: true });

        const API_URL = 'http://127.0.0.1:8000/api';
        let editId = null;
        let globalData = [];
        let isAdmin = localStorage.getItem('role') === 'admin';
        
        updateUI(); 
        ambilData();

        // === LOGIC (SAMA SEPERTI SEBELUMNYA) ===

        function updateUI() {
            if (isAdmin) {
                document.getElementById('admin-panel').classList.remove('hidden');
                document.getElementById('btn-login-nav').classList.add('hidden');
                document.getElementById('btn-logout-nav').classList.remove('hidden');
                document.querySelectorAll('.admin-only').forEach(el => el.classList.remove('hidden'));
            } else {
                document.getElementById('admin-panel').classList.add('hidden');
                document.getElementById('btn-login-nav').classList.remove('hidden');
                document.getElementById('btn-logout-nav').classList.add('hidden');
                document.querySelectorAll('.admin-only').forEach(el => el.classList.add('hidden'));
            }
        }

        const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
        function showLoginModal() { loginModal.show(); }

        function prosesLogin() {
            const email = document.getElementById('email-login').value;
            const password = document.getElementById('pass-login').value;
            fetch(`${API_URL}/login`, {
                method: 'POST', headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                body: JSON.stringify({ email, password })
            }).then(res => {
                if (!res.ok) throw new Error;
                return res.json();
            }).then(data => {
                localStorage.setItem('role', 'admin'); isAdmin = true;
                loginModal.hide(); Swal.fire('Sukses', 'Login Berhasil', 'success');
                updateUI(); ambilData();
            }).catch(() => Swal.fire('Gagal', 'Email/Password Salah', 'error'));
        }

        function logout() {
            localStorage.removeItem('role'); isAdmin = false;
            Swal.fire('Logout', 'Sampai jumpa!', 'info');
            updateUI(); ambilData();
        }

        function ambilData() {
            fetch(`${API_URL}/bookings`).then(res => res.json()).then(data => {
                globalData = data; renderTable(data); hitungStatistik(data);
            });
        }

        function renderTable(data) {
            let html = '';
            data.forEach(item => {
                let date = new Date(item.booking_time).toLocaleString('id-ID');
                let badge = item.service === 'Ganti Oli' ? 'bg-success' : 'bg-primary';
                let aksi = isAdmin ? `
                    <td class="text-end">
                        <button onclick="siapkanEdit(${item.id})" class="btn btn-warning btn-sm text-white rounded-circle">‚úèÔ∏è</button>
                        <button onclick="hapusData(${item.id})" class="btn btn-danger btn-sm rounded-circle">üóëÔ∏è</button>
                    </td>` : `<td class="text-end text-muted admin-only hidden">üîí</td>`;

                html += `<tr><td><span class="fw-bold">${item.name}</span></td><td><span class="badge ${badge}">${item.service}</span></td><td>${date}</td>${aksi}</tr>`;
            });
            document.getElementById('daftar-booking').innerHTML = html;
            updateUI();
        }

        function kirimData() {
            const dataBaru = {
                name: document.getElementById('name').value,
                booking_time: document.getElementById('booking_time').value,
                service: document.getElementById('service').value
            };
            let url = `${API_URL}/bookings`, method = 'POST';
            if (editId) {
                if(!isAdmin) return Swal.fire('Stop', 'Login dulu bro!', 'error');
                url += `/${editId}`; method = 'PUT';
            }
            fetch(url, { method, headers: {'Content-Type':'application/json', 'Accept':'application/json'}, body: JSON.stringify(dataBaru)})
            .then(res => res.json()).then(() => {
                Swal.fire('Sukses', 'Data tersimpan', 'success'); resetForm(); ambilData();
            });
        }

        function hapusData(id) {
            if(!isAdmin) return;
            Swal.fire({ title: 'Hapus?', icon: 'warning', showCancelButton: true, confirmButtonText: 'Ya' }).then((r) => {
                if(r.isConfirmed) fetch(`${API_URL}/bookings/${id}`, { method: 'DELETE', headers: {'Accept':'application/json'} }).then(() => ambilData());
            });
        }

        function siapkanEdit(id) {
            const d = globalData.find(x => x.id === id);
            if(d) {
                document.getElementById('name').value = d.name;
                document.getElementById('booking_time').value = d.booking_time.replace(' ', 'T');
                document.getElementById('service').value = d.service;
                editId = id;
                const btn = document.getElementById('btn-submit');
                btn.innerText = "UPDATE DATA"; btn.classList.replace('btn-orange', 'btn-warning');
                document.getElementById('btn-cancel').classList.remove('hidden');
            }
        }

        function resetForm() {
            document.getElementById('name').value = ''; document.getElementById('booking_time').value = '';
            editId = null;
            const btn = document.getElementById('btn-submit');
            btn.innerText = "BOOKING SEKARANG"; btn.classList.replace('btn-warning', 'btn-orange');
            document.getElementById('btn-cancel').classList.add('hidden');
        }

        function hitungStatistik(data) {
            document.getElementById('stat-total').innerText = data.length;
            document.getElementById('stat-oli').innerText = data.filter(x => x.service === 'Ganti Oli').length;
            document.getElementById('stat-lain').innerText = data.length - data.filter(x => x.service === 'Ganti Oli').length;
        }

        function cariData() {
            const key = document.getElementById('search').value.toLowerCase();
            renderTable(globalData.filter(x => x.name.toLowerCase().includes(key)));
        }
    </script>
</body>
</html>